{% extends "base.html" %}
{% block TITLE %}Restaurant bearbeiten – {{ restaurant.name }}{% endblock %}

{% block CONTENT %}
<div class="container mt-4" style="max-width: 900px;">

  {# Kopfbereich #}
  <div class="mb-3">
    <h1 class="h3 fw-bold mb-1">{{ restaurant.name }}</h1>

    <div class="text-muted">
      {{ restaurant.adresse_zeile }}
      {% if restaurant.geprueft_am or restaurant.status == "approved" %}
        • <span class="badge text-bg-success">Geprüft</span>
      {% else %}
        • <span class="badge text-bg-warning">In Bearbeitung</span>
      {% endif %}

      <div class="small mt-1">
        Erstellt von:
        {{ restaurant.erstellt_von.benutzername if restaurant.erstellt_von else "Unbekannt" }}
      </div>
    </div>
  </div>


    {# TITELBILD (nur anzeigen, wenn vorhanden) #}
    {% set titelbild = restaurant.fotos | selectattr("titelbild") | first %}

    {% if titelbild %}
    <div class="mb-3">
        <img
        src="{{ url_for('static', filename=titelbild.dateipfad.replace('static/', '')) }}"
        alt="Titelbild von {{ restaurant.name }}"
        class="img-fluid rounded-4 shadow-sm w-100"
        style="max-height: 360px; object-fit: cover;">
    </div>
    {% endif %}



  {# Merkmale wie Detailseite: Anzeige #}
  <div class="mb-3">
    <div class="fw-semibold mb-2">Barrierefreiheitsmerkmale</div>
    <div class="d-flex flex-wrap gap-2">
      {% if restaurant.merkmale %}
        {% if restaurant.merkmale.stufenloser_eingang %}<span class="badge badge-access badge-stepfree">Stufenlos</span>{% endif %}
        {% if restaurant.merkmale.barrierefreies_wc %}<span class="badge badge-access badge-wc">WC</span>{% endif %}
        {% if restaurant.merkmale.rampe %}<span class="badge badge-access badge-ramp">Rampe</span>{% endif %}
        {% if restaurant.merkmale.breite_tueren %}<span class="badge badge-access badge-doors">&gt; 90 cm Tür</span>{% endif %}
        {% if restaurant.merkmale.unterfahrbare_tische %}<span class="badge badge-access badge-tables">Unterfahrbar</span>{% endif %}
        {% if restaurant.merkmale.behindertenparkplatz %}<span class="badge badge-access badge-parking">Parkplatz</span>{% endif %}
      {% else %}
        <span class="text-muted">Keine Merkmale vorhanden.</span>
      {% endif %}
    </div>
  </div>


  {# ALLES was gespeichert werden soll, muss im FORM liegen #}
  <form method="post" enctype="multipart/form-data">

    {# Titel + Upload (ohne extra Kasten/Placeholder) #}
    <div class="mb-4">
        <h5 class="fw-semibold mb-2">Titelbild hinzufügen</h5>

        <input class="form-control"
                type="file"
                name="titelbild"
                accept="image/png,image/jpeg,image/webp">
    </div>


    <div class="row g-3">

      {# Merkmale bearbeiten (IM FORM) #}
      <div class="col-12">
        <div class="card shadow-sm rounded-4 mt-1">
          <div class="card-body">
            <h5 class="card-title mb-3">Merkmale bearbeiten</h5>

            <div class="row g-2">
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="stufenloser_eingang" id="stufenloser_eingang"
                         {% if restaurant.merkmale and restaurant.merkmale.stufenloser_eingang %}checked{% endif %}>
                  <label class="form-check-label" for="stufenloser_eingang">Stufenloser Eingang</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="rampe" id="rampe"
                         {% if restaurant.merkmale and restaurant.merkmale.rampe %}checked{% endif %}>
                  <label class="form-check-label" for="rampe">Rampe vorhanden</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="barrierefreies_wc" id="barrierefreies_wc"
                         {% if restaurant.merkmale and restaurant.merkmale.barrierefreies_wc %}checked{% endif %}>
                  <label class="form-check-label" for="barrierefreies_wc">Barrierefreies WC</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="breite_tueren" id="breite_tueren"
                         {% if restaurant.merkmale and restaurant.merkmale.breite_tueren %}checked{% endif %}>
                  <label class="form-check-label" for="breite_tueren">Breite Türen (&gt; 90cm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="unterfahrbare_tische" id="unterfahrbare_tische"
                         {% if restaurant.merkmale and restaurant.merkmale.unterfahrbare_tische %}checked{% endif %}>
                  <label class="form-check-label" for="unterfahrbare_tische">Unterfahrbare Tische</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="behindertenparkplatz" id="behindertenparkplatz"
                         {% if restaurant.merkmale and restaurant.merkmale.behindertenparkplatz %}checked{% endif %}>
                  <label class="form-check-label" for="behindertenparkplatz">Behindertenparkplatz</label>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      {# Linke Card wie Detailseite: Beschreibung + Öffnungszeiten #}
      <div class="col-md-7">
        <div class="card shadow-sm rounded-4">
          <div class="card-body">
            <h5 class="card-title mb-3">Beschreibung</h5>
            <div class="text-muted">
              {{ restaurant.beschreibung or "Keine Beschreibung vorhanden." }}
            </div>

            <hr>

            <h5 class="card-title mb-2">Öffnungszeiten</h5>
            <textarea class="form-control" name="oeffnungszeiten" rows="4"
                      placeholder="z.B. Mo–Fr: 10:00–18:00">{{ restaurant.oeffnungszeiten or "" }}</textarea>
          </div>
        </div>
      </div>



      {# Rechte Card wie Detailseite: Standort + Koordinatenfelder #}
      <div class="col-md-5">
        <div class="card shadow-sm rounded-4">
          <div class="card-body">
            <h5 class="card-title mb-3">Standort</h5>

            <div class="mb-2 small text-muted">
              {% if restaurant.breitengrad and restaurant.laengengrad %}
                Lat: {{ restaurant.breitengrad }} • Lng: {{ restaurant.laengengrad }}
              {% else %}
                Keine Koordinaten vorhanden.
              {% endif %}
            </div>

            <div class="mb-3">
              <label class="form-label">Breitengrad</label>
              <input class="form-control" name="breitengrad" value="{{ restaurant.breitengrad or '' }}">
            </div>

            <div class="mb-3">
              <label class="form-label">Längengrad</label>
              <input class="form-control" name="laengengrad" value="{{ restaurant.laengengrad or '' }}">
            </div>

            <hr>

            <div class="mb-3">
              <label class="form-label">Status</label>
              <select class="form-select" name="status">
                <option value="pending" {% if restaurant.status != "approved" %}selected{% endif %}>In Bearbeitung</option>
                <option value="approved" {% if restaurant.status == "approved" %}selected{% endif %}>Geprüft</option>
              </select>
            </div>

            <div class="d-flex gap-2">
              <button class="btn btn-secondary" type="submit">Speichern</button>
              <a class="btn btn-link" href="{{ url_for('detail', id=restaurant.id) }}">Abbrechen</a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </form>

</div>
{% endblock %}