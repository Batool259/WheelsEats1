{% extends "base.html" %}

{% block TITLE %}Startseite{% endblock %}

{% block CONTENT %}

<section class="my-3">
  <form class="row g-2 my-3" method="GET" action="{{ url_for('index') }}">
    <div class="col-md-10">
      <input
        class="form-control"
        name="q"
        type="text"
        placeholder="Restaurant oder Adresse"
        value="{{ q or '' }}">
    </div>

    <div class="col-md-2 d-grid">
      <button class="btn btn-primary" type="submit">Suchen</button>
    </div>

    <!-- Filter -->
<!-- Toggle-Button: Filter anzeigen/verstecken -->
<div class="col-12">
  <div class="d-flex align-items-center justify-content-between">
    <button class="btn btn-outline-primary btn-sm rounded-pill"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#filterPanel"
            aria-expanded="false"
            aria-controls="filterPanel">
      Filter â–¾
    </button>

    <a class="small text-decoration-none" href="{{ url_for('index') }}">ZurÃ¼cksetzen</a>
  </div>
</div>

<!-- Verstecktes Filter-Panel -->
<div class="collapse mt-2" id="filterPanel">
  <div class="card we-filter-card border-0 shadow-sm rounded-4">
    <div class="card-body p-3 p-md-4">

      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="fw-semibold">Filter</div>
      </div>

      <div class="we-filter-grid">
        <label class="we-chip">
          <input type="checkbox" name="stufenloser_eingang" value="1"
                 {% if request.args.get('stufenloser_eingang') %}checked{% endif %}>
          <span>â™¿ Stufenlos</span>
        </label>

        <label class="we-chip">
          <input type="checkbox" name="barrierefreies_wc" value="1"
                 {% if request.args.get('barrierefreies_wc') %}checked{% endif %}>
          <span>ğŸš» WC</span>
        </label>

        <label class="we-chip">
          <input type="checkbox" name="rampe" value="1"
                 {% if request.args.get('rampe') %}checked{% endif %}>
          <span>â†—ï¸ Rampe</span>
        </label>

        <label class="we-chip">
          <input type="checkbox" name="breite_tueren" value="1"
                 {% if request.args.get('breite_tueren') %}checked{% endif %}>
          <span>ğŸšª Breite TÃ¼ren</span>
        </label>

        <label class="we-chip">
          <input type="checkbox" name="unterfahrbare_tische" value="1"
                 {% if request.args.get('unterfahrbare_tische') %}checked{% endif %}>
          <span>ğŸª‘ Unterfahrbar</span>
        </label>

        <label class="we-chip">
          <input type="checkbox" name="behindertenparkplatz" value="1"
                 {% if request.args.get('behindertenparkplatz') %}checked{% endif %}>
          <span>ğŸ…¿ Parkplatz</span>
        </label>
      </div>

      <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-primary btn-sm rounded-pill px-4" type="submit">
          Filter anwenden
        </button>
      </div>

    </div>
  </div>
</div>

  </form>
</section>

<section>
  <h2 class="mb-3">Barrierefreie Restaurants</h2>

  {% for r in restaurants %}
    {% set titelbild = r.fotos | selectattr("titelbild") | first %}

    <div class="card mb-3">
      <div class="card-body d-flex gap-3 align-items-start">

        <!-- Bild links -->
        <div style="width: 180px; flex: 0 0 180px;">
          {% if titelbild %}
            <img
              src="{{ url_for('static', filename=titelbild.dateipfad.replace('static/', '')) }}"
              class="img-fluid rounded-3"
              style="height: 110px; width: 180px;"
              alt="Bild von {{ r.name }}">
          {% else %}
            <img
              src="https://picsum.photos/360/220"
              class="img-fluid rounded-3"
              style="height: 110px; width: 180px;"
              alt="Platzhalterbild">
          {% endif %}
        </div>

        <!-- Infos Mitte -->
        <div class="flex-grow-1">
          <h5 class="card-title mb-1">{{ r.name }}</h5>
          <div class="text-muted mb-2">
            {{ r.adresse_zeile }}
            {% if r.geprueft_am or r.status == "approved" %}
            â€¢ <span class="badge text-bg-secondary">GeprÃ¼ft</span>
            {% else %}
            â€¢ <span class="badge text-bg-secondary">In Bearbeitung</span>
            {% endif %}
          </div>


          <!-- Merkmale -->
          <div class="d-flex flex-wrap gap-2">
            {% if r.merkmale %}
              {% if r.merkmale.stufenloser_eingang %}
                <span class="badge badge-access badge-stepfree">â™¿ Stufenlos</span>
              {% endif %}
              {% if r.merkmale.barrierefreies_wc %}
                <span class="badge badge-access badge-wc">ğŸš» WC</span>
              {% endif %}
              {% if r.merkmale.rampe %}
                <span class="badge badge-access badge-ramp">â†—ï¸ Rampe</span>
              {% endif %}
              {% if r.merkmale.breite_tueren %}
                <span class="badge badge-access badge-door">&gt; 90 cm TÃ¼r</span>
              {% endif %}
              {% if r.merkmale.unterfahrbare_tische %}
                <span class="badge badge-access badge-table">ğŸª‘ Unterfahrbar</span>
              {% endif %}
              {% if r.merkmale.behindertenparkplatz %}
                <span class="badge badge-access badge-parking">ğŸ…¿ Parkplatz</span>
              {% endif %}
            {% endif %}
          </div>
        </div>

        <!-- Button rechts -->
        <div class="ms-auto">
          <a href="{{ url_for('detail', id=r.id) }}" class="btn btn-outline-primary">
            Details ansehen
          </a>
        </div>

      </div>
    </div>

  {% else %}
    <div class="text-muted">Keine Restaurants gefunden.</div>
  {% endfor %}
</section>

{% endblock %}
