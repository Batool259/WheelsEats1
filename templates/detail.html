{% extends "base.html" %}

{% block TITLE %}{{ restaurant.name }}{% endblock %}

{% block CONTENT %}

<div class="mb-3">
  <h1 class="h3 fw-bold mb-1">{{ restaurant.name }}</h1>
  <div class="text-muted">
    {{ restaurant.adresse_zeile }}
    {% if restaurant.geprueft_am or restaurant.status == "approved" %}
      â€¢ <span class="badge text-bg-success">GeprÃ¼ft</span>
    {% else %}
      â€¢ <span class="badge text-bg-warning">In Bearbeitung</span>
    {% endif %}
    <div class="small mt-1">
      Erstellt von:
      {{ restaurant.erstellt_von.benutzername if restaurant.erstellt_von else "Unbekannt" }}
    </div>
  </div>
</div>


{% if session.get("role") == "admin" %}
  <div class="mb-3">
    <a class="btn btn-sm btn-outline-secondary"
       href="{{ url_for('restaurant_edit', id=restaurant.id) }}">
      Restaurant bearbeiten
    </a>
  </div>
{% endif %}


{# TITELBILD #}
{% set titelbild = restaurant.fotos | selectattr("titelbild") | first %}

<div class="mb-4">
  {% if titelbild %}
    <img
      src="{{ url_for('static', filename=titelbild.dateipfad.replace('static/', '')) }}"
      alt="Titelbild von {{ restaurant.name }}"
      class="img-fluid rounded-4 shadow-sm w-100"
      style="max-height: 360px; object-fit: cover;">
  {% else %}
    <img
      src="https://picsum.photos/1200/600"
      alt="Platzhalterbild"
      class="img-fluid rounded-4 shadow-sm w-100"
      style="max-height: 360px; object-fit: cover;">
  {% endif %}
</div>

<!-- Merkmale -->
<div class="mb-4">
  <h2 class="h5 fw-semibold mb-2">Barrierefreiheitsmerkmale</h2>

  <div class="d-flex flex-wrap gap-2 mb-3">
    {% if restaurant.merkmale %}
      {% if restaurant.merkmale.stufenloser_eingang %}
        <span class="badge badge-access badge-stepfree">â™¿ Stufenlos</span>
      {% endif %}
      {% if restaurant.merkmale.barrierefreies_wc %}
        <span class="badge badge-access badge-wc">ğŸš» WC</span>
      {% endif %}
      {% if restaurant.merkmale.rampe %}
        <span class="badge badge-access badge-ramp">â†—ï¸ Rampe</span>
      {% endif %}
      {% if restaurant.merkmale.breite_tueren %}
        <span class="badge badge-access badge-door">&gt; 90 cm TÃ¼r</span>
      {% endif %}
      {% if restaurant.merkmale.unterfahrbare_tische %}
        <span class="badge badge-access badge-table">ğŸª‘ Unterfahrbar</span>
      {% endif %}
      {% if restaurant.merkmale.behindertenparkplatz %}
        <span class="badge badge-access badge-parking">ğŸ…¿ Parkplatz</span>
      {% endif %}
    {% else %}
      <span class="text-muted">Keine Merkmale hinterlegt.</span>
    {% endif %}
  </div>

  <!-- HIER ist der wichtige Teil: row + 2 cols -->
  <div class="row g-3">
    <!-- Beschreibung + Ã–ffnungszeiten -->
    <div class="col-12 col-lg-7">
      <div class="card h-100">
        <div class="card-body">
          <h2 class="h5 fw-semibold">Beschreibung</h2>
          <p class="mb-0">
            {{ restaurant.beschreibung or "Keine Beschreibung vorhanden." }}
          </p>

          <hr>

          <h2 class="h5 fw-semibold">Ã–ffnungszeiten</h2>
          <p class="mb-0">
            {{ restaurant.oeffnungszeiten or "Keine Ã–ffnungszeiten angegeben." }}
          </p>
        </div>
      </div>
    </div>

    <!-- Standort -->
    <div class="col-12 col-lg-5">
      <div class="card h-100">
        <div class="card-body">
          <h2 class="h5 fw-semibold">Standort</h2>

          {% if restaurant.breitengrad and restaurant.laengengrad %}
            <div class="text-muted mb-2">
              Lat: {{ restaurant.breitengrad }} â€¢ Lng: {{ restaurant.laengengrad }}
            </div>

            <a class="btn btn-outline-primary w-100"
               target="_blank"
               href="https://www.google.com/maps?q={{ restaurant.breitengrad }},{{ restaurant.laengengrad }}">
              Route planen
            </a>
          {% else %}
            <div class="text-muted">Keine Koordinaten vorhanden.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Bewertungen -->
<div class="mt-4">
  <div class="d-flex justify-content-between align-items-end mb-2">
    <h2 class="h5 fw-semibold mb-0">Community-Bewertungen</h2>

    <div class="text-muted">
      {% if avg %}
        <strong>{{ "%.1f"|format(avg) }}</strong> / 5
        ({{ bewertungen|length }} Bewertung{{ "" if bewertungen|length == 1 else "en" }})
      {% else %}
        Noch keine Bewertungen
      {% endif %}
    </div>
  </div>

  {% if bewertungen %}
    <div class="row g-3">
      {% for b in bewertungen %}
        <div class="col-md-6">
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div class="fw-semibold">
                  {{ b.nutzer.benutzername if b.nutzer else "Anonym" }}
                </div>
                <div class="fw-semibold">{{ "â˜…" * b.sterne }}{{ "â˜†" * (5 - b.sterne) }}</div>
              </div>
              <div class="text-muted small mb-2">{{ b.erstellt_am.strftime("%d.%m.%Y") }}</div>
              <div>{{ b.text or "" }}</div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-muted">Es gibt noch keine Bewertungen.</div>
  {% endif %}
</div>

{% endblock %}
