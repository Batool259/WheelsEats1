{% extends "base.html" %}

{% block TITLE %}{{ restaurant.name }}{% endblock %}

{% block CONTENT %}

<div class="mb-3">
  <h1 class="h3 fw-bold mb-1">{{ restaurant.name }}</h1>
  <div class="text-muted">
    {{ restaurant.adresse_zeile }}
    {% if restaurant.geprueft_am %}
      • <span class="badge text-bg-success">Geprüft</span>
    {% endif %}
  </div>
</div>

<!-- Merkmale -->
<div class="mb-4">
  <h2 class="h5 fw-semibold mb-2">Barrierefreiheitsmerkmale</h2>

  <div class="d-flex flex-wrap gap-2">
    {% if restaurant.merkmale %}
      {% if restaurant.merkmale.stufenloser_eingang %}
        <span class="badge rounded-pill text-bg-success">Stufenloser Eingang</span>
      {% endif %}
      {% if restaurant.merkmale.rampe %}
        <span class="badge rounded-pill text-bg-success">Rampe vorhanden</span>
      {% endif %}
      {% if restaurant.merkmale.barrierefreies_wc %}
        <span class="badge rounded-pill text-bg-success">Barrierefreies WC</span>
      {% endif %}
      {% if restaurant.merkmale.breite_tueren %}
        <span class="badge rounded-pill text-bg-success">Breite Türen (&gt; 90 cm)</span>
      {% endif %}
      {% if restaurant.merkmale.unterfahrbare_tische %}
        <span class="badge rounded-pill text-bg-success">Unterfahrbare Tische</span>
      {% endif %}
      {% if restaurant.merkmale.behindertenparkplatz %}
        <span class="badge rounded-pill text-bg-success">Behindertenparkplatz</span>
      {% endif %}
    {% else %}
      <span class="text-muted">Keine Merkmale hinterlegt.</span>
    {% endif %}
  </div>
</div>

<div class="row g-4">
  <!-- Beschreibung + Öffnungszeiten -->
  <div class="col-lg-7">
    <div class="card">
      <div class="card-body">
        <h2 class="h5 fw-semibold">Beschreibung</h2>
        <p class="mb-0">
          {{ restaurant.beschreibung or "Keine Beschreibung vorhanden." }}
        </p>

        <hr>

        <h2 class="h5 fw-semibold">Öffnungszeiten</h2>
        <p class="mb-0">
          {{ restaurant.oeffnungszeiten or "Keine Öffnungszeiten angegeben." }}
        </p>
      </div>
    </div>
  </div>

  <!-- Mini-Karte/Koordinaten -->
  <div class="col-lg-5">
    <div class="card">
      <div class="card-body">
        <h2 class="h5 fw-semibold">Standort</h2>

        {% if restaurant.breitengrad and restaurant.laengengrad %}
          <div class="text-muted mb-2">
            Lat: {{ restaurant.breitengrad }} • Lng: {{ restaurant.laengengrad }}
          </div>

          <a class="btn btn-outline-primary w-100"
             target="_blank"
             href="https://www.google.com/maps?q={{ restaurant.breitengrad }},{{ restaurant.laengengrad }}">
            Route planen
          </a>
        {% else %}
          <div class="text-muted">Keine Koordinaten vorhanden.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Bewertungen -->
<div class="mt-4">
  <div class="d-flex justify-content-between align-items-end mb-2">
    <h2 class="h5 fw-semibold mb-0">Community-Bewertungen</h2>

    <div class="text-muted">
      {% if avg %}
        <strong>{{ "%.1f"|format(avg) }}</strong> / 5
        ({{ bewertungen|length }} Bewertung{{ "" if bewertungen|length == 1 else "en" }})
      {% else %}
        Noch keine Bewertungen
      {% endif %}
    </div>
  </div>

  {% if bewertungen %}
    <div class="row g-3">
      {% for b in bewertungen %}
        <div class="col-md-6">
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div class="fw-semibold">Bewertung</div>
                <div class="fw-semibold">{{ "★" * b.sterne }}{{ "☆" * (5 - b.sterne) }}</div>
              </div>
              <div class="text-muted small mb-2">{{ b.erstellt_am.strftime("%d.%m.%Y") }}</div>
              <div>{{ b.text or "" }}</div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-muted">Es gibt noch keine Bewertungen.</div>
  {% endif %}
</div>

{% endblock %}
